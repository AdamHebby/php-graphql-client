# php-graphql-client
A GraphQL client written in PHP that provides a very simple, yet powerful, query generator class which makes writing
GraphQL queries a very simple process. The package also generates schema objects that can be used to generate queries
based on the types declared in the API schema using the introspection feature in GraphQL.

# Query Example: Simple Query
```
$gql = (new Query('Company'))
    ->setSelectionSet(
        [
            'name',
            'serialNumber'
        ]
    );
```
This simple query will retrieve all companies displaying their names and serial numbers.

# Query Example: Nested Queries
```
$gql = (new Query('Company'))
    ->setSelectionSet(
        [
            'name',
            'serialNumber',
            (new Query('branches'))
                ->setSelectionSet(
                    [
                        'address',
                        (new Query('contracts'))
                            ->setSelectionSet(['date'])
                    ]
                )
        ]
    );
```
This query is a more complex one, retrieving not just scalar fields, but object fields as well. This query returns all
companies, displaying their names, serial numbers, and for each company, all its branches, displaying the branch address,
and for each address, it retrieves all contracts bound to this address, displaying their dates.

# Query Example: Query With Arguments
```
$gql = (new Query('Company'))
    ->setArguments(['name' => 'Tech Co.', 'first' => 3])
    ->setSelectionSet(
        [
            'name',
            'serialNumber'
        ]
    );
```
This query does not retrieve all companies by adding arguments. This query will retrieve the first 3 companies with the
name "Tech Co.", displaying their names and serial numbers. 

# Query Example: Query With Array Argument
```
$gql = (new Query('Company'))
    ->setArguments(['serialNumbers' => [159, 260, 371]])
    ->setSelectionSet(
        [
            'name',
            'serialNumber'
        ]
    );
```
This query is a special case of the arguments query. In this example, the query will retrieve only the companies with
serial number in one of 159, 260, and 371, displaying the name and serial number.

# Query Example: Query With Input Object Argument
```
$gql = (new Query('Company'))
    ->setArguments(['filter' => new RawObject('{name_starts_with: "Face"}')])
    ->setSelectionSet(
        [
            'name',
            'serialNumber'
        ]
    );
```
This query is another special case of the arguments query. In this example, we're setting a custom input object "filter"
with some values to limit the companies being returned. We're setting the filter "name_starts_with" with value "Face".
This query will retrieve only the companies whose names start with the phrase "Face".

The RawObject class being constructed is used for injecting the string into the query as it is. Whatever string is input
into the RawObject constructor will be put in the query as it is without any custom formatting normally done by the
query class.

# Constructing The Client
A Client object can easily be instantiated by providing the GraphQL endpoint URL. The Client constructor also receives
an optional "authorizationHeaders" array, which can be used to add authorization headers to all requests being sent to
the GraphQL server.

Example:
```
$client = new Client(
    'http://api.graphql.com',
    ['Authorization' => 'Basic xyz']
);
```

# Running Queries:

Running query with the GraphQL client and getting the results in object structure:
```
$results = $client->runQuery($gql);
$results->getData()->Company[0]->branches;
```
Or getting results in array structure:
```
$results = $client->runQuery($gql, true);
$results->getData()['Company'][1]['branches']['address']
```

# Complex Query Examples
```
$gql = (new Query('Company'))
    ->setArguments(['name' => 'XYZ', 'first' => 3])
    ->setSelectionSet(
        [
            'name',
            (new Query('branches'))
                ->setArguments(['first' => 1])
                ->setSelectionSet(
                    [
                        'address',
                        (new Query('contracts'))
                            ->setArguments(['first' => 3])
                            ->setSelectionSet(['date'])
                    ]
                )
        ]
    );
```

# Generating The Schema Objects (Beta)
Schema objects can easily be generated by executing the command:
```
bin/build_schema
```
 This script will generate the schema objects from your API's schema types and save them in the `schema_object` directory
 in the root directory of the package.
 
 # The Schema Object Classes
 The schema scanner will generate to classes for each query type in the schema:
 - {TypeName}Trait: Contains the fields in defined in the query type
 - {TypeName}QueryObject: Contains the setter methods to set arguments and select methods to add a field to the selection set of the query
 
 Example:
 
 TestTrait:
 ```
 trait TestTrait
 {
     protected $property_one;
     protected $propertyTwo;
 }

```
 
 TestQueryObject:
 ```
 class TestQueryObject extends QueryObject
 {
     use TestTrait;
 
     const OBJECT_NAME = 'Test';
 
     public function setPropertyOne($propertyOne)
     {
         $this->property_one = $propertyOne;
     
         return $this;
     }
 
     public function selectPropertyOne()
     {
         $this->selectField('property_one');
     
         return $this;
     }
 
     public function setPropertyTwo($propertyTwo)
     {
         $this->propertyTwo = $propertyTwo;
     
         return $this;
     }
 
     public function selectPropertyTwo()
     {
         $this->selectField('propertyTwo');
     
         return $this;
     }
 
     public function selectOtherObjects()
     {
         $object = new OtherObjectQueryObject('other_objects');
         $this->selectField($object);
     
         return $object;
     }
 }

``` 
 
 # Using The Object 
 
 ```
$testQuery = new TestQueryObject();
$testQuery->selectPropertyTwo()->setFirst(10)->setPropertyOne('some_value');
$testQuery->selectOtherObjects()->selectName()->setFirst(5);

print $testQuery->getQueryString();
```
Results in the following query string:
```
query {
Test(first: 10 property_one: "some_value") {
propertyTwo
other_objects(first: 5) {
name
}
}
}
```

The query object can be easily run by using the GraphQL client:
```
$client->runQueryObject($testQuery);
```

# Supported Feature
- Query builder
- Generating schema objects from API types (Beta)
- Using schema objects to build queries
- Results parsing in multiple formats
- Reporting API errors

# Feature on-Track
- Mutation types
- Query and field aliases
- Fragment types
